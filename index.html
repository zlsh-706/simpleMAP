<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>北一女中 交通指引地圖</title>
    <!-- 引入必要的函式庫 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .writing-vertical { writing-mode: vertical-rl; text-orientation: upright; }
        @keyframes pulse { 50% { opacity: .5; } }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        body { margin: 0; overflow-x: hidden; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        // --- 這裡的資料已經被寫死，不需要再匯入 ---
        const mapElements = {"streetTop":{"id":"streetTop","label":"上方街道","text":"貴陽街一段","cx":50,"cy":15,"w":100,"h":12,"type":"street-h","color":"bg-gray-300"},"streetBottom":{"id":"streetBottom","label":"下方街道","text":"愛國西路","cx":50,"cy":85,"w":100,"h":12,"type":"street-h","color":"bg-gray-300"},"streetLeft":{"id":"streetLeft","label":"左側街道","text":"重慶南路一段","cx":15,"cy":50,"w":12,"h":100,"type":"street-v","color":"bg-gray-300"},"streetRight":{"id":"streetRight","label":"右側街道","text":"公園路","cx":85,"cy":50,"w":12,"h":100,"type":"street-v","color":"bg-gray-300"},"destination":{"id":"destination","label":"主要目的地","text":"北一女中","sub":"正門","cx":41,"cy":41,"w":40,"h":40,"type":"dest","color":"bg-green-200","ex":7,"ey":0},"landmark":{"id":"landmark","label":"右側地標","text":"市立大學\n附小","cx":97,"cy":65,"w":10,"h":19,"type":"landmark","color":"bg-yellow-100"}};
        const stops = [{"id":"chongqing","name":"一女中 (重慶)","locationDescription":"位於重慶南路一段","routes":"262, 262區","x":19,"y":61,"pathType":"left","color":"bg-blue-600"},{"id":"park","name":"一女中 (公園)","locationDescription":"位於公園路","routes":"5, 204, 630, 227","x":91,"y":47,"pathType":"right","color":"bg-green-600"},{"id":"guiyang","name":"一女中 (貴陽)","locationDescription":"位於貴陽街一段","routes":"38, 270, 235, 663","x":60,"y":9,"pathType":"top","color":"bg-orange-500"}];

        const { useState } = React;

        // 定義簡單的圖示元件 (取代 Lucide，避免 import 錯誤)
        const BusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 6v6"/><path d="M15 6v6"/><path d="M2 12h19.6"/><path d="M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.34-.1-.66-.31-.93l-2.67-3.46c-.25-.33-.64-.53-1.06-.53H6.94c-.42 0-.81.2-1.06.53L3.21 13.07c-.21.27-.31.59-.31.93 0 .4.1.8.2 1.2.3 1.1.8 2.8.8 2.8h3"/><path d="M4 22v-4"/><path d="M20 22v-4"/><rect width="16" height="16" x="4" y="2" rx="2"/></svg>;
        const MapPinIcon = ({size=24, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>;
        const NavigationIcon = ({size=24, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>;
        const InfoIcon = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;

        // 主應用程式 (簡化版，無編輯功能)
        function MapViewer() {
            const [selectedStopId, setSelectedStopId] = useState(null);
            
            const getSelectedStop = () => stops.find(s => s.id === selectedStopId);

            const renderPath = (stop) => {
                if (!stop || !mapElements.destination) return null;
                const dest = mapElements.destination;
                
                const dW = dest.w; const dH = dest.h;
                const dL = dest.cx - dW/2; const dR = dest.cx + dW/2;
                const dT = dest.cy - dH/2; const dB = dest.cy + dH/2;
                const exVal = dest.ex !== undefined ? dest.ex : 50;
                const eyVal = dest.ey !== undefined ? dest.ey : 100;
                const targetX = dL + (dW * exVal / 100);
                const targetY = dT + (dH * eyVal / 100);

                const dists = { top: Math.abs(targetY-dT), bottom: Math.abs(targetY-dB), left: Math.abs(targetX-dL), right: Math.abs(targetX-dR) };
                const endSide = Object.keys(dists).reduce((a, b) => dists[a] < dists[b] ? a : b);
                
                const safeMargin = 6;
                const streetTop = dT - safeMargin; const streetBottom = dB + safeMargin;
                const streetLeft = dL - safeMargin; const streetRight = dR + safeMargin;
                const startSide = stop.pathType;
                
                let points = [{x: stop.x, y: stop.y}];

                if (startSide === endSide) {
                     if (startSide === 'left' || startSide === 'right') points.push({ x: stop.x, y: targetY }); 
                     else points.push({ x: targetX, y: stop.y });
                } else {
                    const isOpposite = (startSide === 'left' && endSide === 'right') || (startSide === 'right' && endSide === 'left') || (startSide === 'top' && endSide === 'bottom') || (startSide === 'bottom' && endSide === 'top');
                    if (isOpposite) {
                        if (startSide === 'left' || startSide === 'right') {
                            const goTop = Math.abs(stop.y - dT) < Math.abs(stop.y - dB);
                            const viaY = goTop ? streetTop : streetBottom;
                            const endStreetX = endSide === 'left' ? streetLeft : streetRight;
                            points.push({x: stop.x, y: viaY}, {x: endStreetX, y: viaY}, {x: endStreetX, y: targetY});
                        } else {
                            const goLeft = Math.abs(stop.x - dL) < Math.abs(stop.x - dR);
                            const viaX = goLeft ? streetLeft : streetRight;
                            const endStreetY = endSide === 'top' ? streetTop : streetBottom;
                            points.push({x: viaX, y: stop.y}, {x: viaX, y: endStreetY}, {x: targetX, y: endStreetY});
                        }
                    } else {
                        let cornerX = stop.x; let cornerY = stop.y;
                        if (endSide === 'top') cornerY = streetTop; if (endSide === 'bottom') cornerY = streetBottom;
                        if (endSide === 'left') cornerX = streetLeft; if (endSide === 'right') cornerX = streetRight;
                        if (startSide === 'left' || startSide === 'right') points.push({x: stop.x, y: cornerY}, {x: targetX, y: cornerY});
                        else points.push({x: cornerX, y: stop.y}, {x: cornerX, y: targetY});
                    }
                }
                points.push({x: targetX, y: targetY});
                return <path d={"M "+points.map(p=>p.x+" "+p.y).join(" L ")} stroke="#2563eb" strokeWidth="3" fill="none" markerEnd="url(#arrowhead)" strokeDasharray="6,4" className="animate-pulse" vectorEffect="non-scaling-stroke" strokeLinejoin="round" strokeLinecap="round" />;
            };

            const renderMapElement = (key, config) => {
                const baseStyle = { left: config.cx+'%', top: config.cy+'%', width: config.w+'%', height: config.h+'%' };
                let content = null;
                if (config.type === 'street-h') content = <span className="text-gray-500 font-bold tracking-widest text-lg opacity-60 pointer-events-none select-none">{config.text}</span>;
                else if (config.type === 'street-v') content = <span className="transform -rotate-90 lg:rotate-90 text-gray-500 font-bold tracking-widest text-lg whitespace-nowrap opacity-60 pointer-events-none select-none">{config.text}</span>;
                else if (config.type === 'dest') {
                    const ex = config.ex !== undefined ? config.ex : 50;
                    const ey = config.ey !== undefined ? config.ey : 100;
                    content = <div className="flex flex-col items-center justify-center pointer-events-none select-none w-full h-full relative"><div className="bg-green-700 text-white text-[10px] lg:text-xs px-2 py-1 rounded mb-1 lg:mb-2 whitespace-nowrap">目的地</div><div className="font-bold text-xl lg:text-2xl text-green-900 text-center leading-tight whitespace-pre-wrap">{config.text}</div>{config.sub && <div className="text-green-800 text-xs lg:text-sm mt-1 font-bold">{config.sub}</div>}<div className="absolute bg-yellow-400 border border-yellow-600 rounded-full px-3 py-0.5 text-[10px] font-bold shadow-sm transform -translate-x-1/2 -translate-y-1/2 whitespace-nowrap z-20" style={{ left: ex+'%', top: ey+'%' }}>入口</div></div>;
                }
                else if (config.type === 'landmark') content = <span className="text-yellow-700 font-bold writing-vertical text-center whitespace-pre-line leading-6 pointer-events-none select-none text-xs lg:text-base">{config.text}</span>;
                return <div key={key} style={baseStyle} className={"absolute transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center "+config.color+" "+(config.type==='dest'?'border-2 border-green-600 rounded-lg shadow-sm z-10':'')+" "+(config.type==='landmark'?'border-2 border-yellow-300 rounded-lg opacity-80 z-0':'')}>{content}</div>;
            };

            return (
                <div className="min-h-screen flex flex-col items-center p-4 font-sans text-gray-800">
                    <header className="w-full max-w-6xl bg-white p-3 rounded-xl shadow-sm border border-gray-200 flex justify-between items-center mb-4">
                        <h1 className="text-xl font-bold flex items-center gap-2 text-blue-900">
                            <MapPinIcon size={20} />
                            {mapElements.destination ? mapElements.destination.text : '交通地圖'}
                        </h1>
                    </header>
                    <div className="flex flex-col lg:flex-row w-full max-w-6xl gap-4 h-[calc(100vh-140px)] min-h-[600px]">
                        <div className="relative w-full lg:w-2/3 bg-white rounded-xl shadow-md border-4 border-gray-200 overflow-hidden select-none flex flex-col">
                            <div className="relative w-full h-full bg-gray-100 overflow-hidden" onClick={()=>setSelectedStopId(null)}>
                                {Object.keys(mapElements).map(key => renderMapElement(key, mapElements[key]))}
                                <svg className="absolute inset-0 w-full h-full pointer-events-none z-20" viewBox="0 0 100 100" preserveAspectRatio="none">
                                    <defs><marker id="arrowhead" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"><polygon points="0 0, 6 3, 0 6" fill="#2563eb" /></marker></defs>
                                    {renderPath(getSelectedStop())}
                                </svg>
                                {stops.map((stop) => (
                                    <button key={stop.id} onClick={(e) => { e.stopPropagation(); setSelectedStopId(stop.id); }} style={{ top: stop.y+'%', left: stop.x+'%' }} className={"absolute z-30 transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 group "+(selectedStopId === stop.id ? 'scale-125 z-40' : 'hover:scale-110')}>
                                        <div className={"w-10 h-10 lg:w-12 lg:h-12 rounded-full "+stop.color+" text-white flex items-center justify-center border-2 border-white shadow-lg "+(selectedStopId === stop.id ? 'ring-4 ring-yellow-400' : '')}><BusIcon /></div>
                                        <div className={"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 px-2 py-1 bg-white text-xs font-bold rounded shadow-md border border-gray-200 whitespace-nowrap "+(selectedStopId === stop.id ? 'text-blue-700 ring-2 ring-blue-300' : 'text-gray-700')}>{stop.name}</div>
                                    </button>
                                ))}
                                <div className="absolute top-4 right-4 text-gray-400 flex flex-col items-center opacity-50 pointer-events-none"><div className="text-lg font-serif font-bold">N</div><div className="w-1 h-6 bg-gray-400 rounded-full"></div></div>
                            </div>
                        </div>
                        <div className="w-full lg:w-1/3 flex flex-col h-full overflow-hidden">
                            <div className="bg-white p-6 rounded-xl shadow-md border border-gray-200 h-full overflow-y-auto">
                                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center border-b pb-2"><InfoIcon className="mr-2 text-blue-600" />詳細資訊</h2>
                                {getSelectedStop() ? (
                                    <div className="animate-fade-in">
                                        <h3 className="text-2xl font-bold text-blue-800 mb-2">{getSelectedStop().name}</h3>
                                        <p className="text-gray-500 text-sm mb-4 flex items-center"><MapPinIcon size={16} className="mr-1" />{getSelectedStop().locationDescription}</p>
                                        <div className="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-4"><h4 className="font-bold text-blue-900 mb-2 flex items-center"><BusIcon size={18} className="mr-2" />停靠公車路線</h4><div className="flex flex-wrap gap-2">{getSelectedStop().routes.split(/,|，/).map((route, idx) => (<span key={idx} className="px-3 py-1 bg-white text-blue-600 font-bold rounded-full shadow-sm border border-blue-200 text-sm">{route.trim()}</span>))}</div></div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-100"><h4 className="font-bold text-green-900 mb-2 flex items-center"><NavigationIcon size={18} className="mr-2" />步行指引</h4><p className="text-gray-700 text-sm leading-relaxed">下車後，請依照地圖上的<span className="text-blue-600 font-bold mx-1">藍色虛線箭頭</span>方向，前往 {mapElements.destination.text}。</p></div>
                                    </div>
                                ) : (
                                    <div className="h-full flex flex-col items-center justify-center text-gray-400 text-center py-10 opacity-60"><BusIcon size={48} className="mb-4 opacity-20" /><p>請點擊左側地圖上的<br/>公車圖示以查看資訊</p></div>
                                )}
                            </div>
                        </div>
                    </div>
                     <footer className="mt-4 text-gray-400 text-xs text-center">資料來源：Google Maps 彙整 | 僅供參考</footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MapViewer />);
    </script>
</body>
</html>
    
